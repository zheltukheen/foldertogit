# Folder to Git

Универсальный инструмент для преобразования папок с версиями любого проекта в Git-репозиторий.

## Описание

Этот проект предоставляет инструменты для создания Git-репозитория из набора папок, содержащих разные версии проекта. Инструмент автоматически определяет структуру проекта, извлекает версии из имен папок, сортирует их по датам изменения файлов и создает коммиты, обеспечивая правильную историю изменений.

Проект поддерживает два варианта реализации:
- **Python-скрипт** (`folder_to_git.py`): Более универсальный и гибкий вариант с расширенными возможностями
- **Shell-скрипт** (`folder_to_git.sh`): Легкий вариант, работающий в большинстве Unix-подобных систем без дополнительных зависимостей

## Особенности

- **Универсальность**: Работает с проектами любого типа, автоматически определяя структуру проекта
- **Гибкость**: Настраиваемые шаблоны для поиска папок и извлечения версий
- Автоматическое определение версий из имен папок с помощью настраиваемых регулярных выражений
- Интеллектуальная сортировка по времени изменения файлов (используется самый старый файл в каждой папке)
- Безопасное копирование файлов с исключением служебных директорий (.git, __pycache__ и др.)
- Тестовый режим (dry-run) для проверки процесса миграции без создания репозитория
- Подробное логирование процесса миграции
- Поддержка кастомизации шаблонов сообщений коммитов
- Опциональная поддержка информации об авторах для разных версий

## Требования

### Для Python-скрипта:
- Python 3.6 или выше
- Git, установленный в системе и доступный в PATH

### Для Shell-скрипта:
- Bash-совместимая оболочка
- Git, установленный в системе и доступный в PATH
- Базовые Unix-утилиты (grep, awk, sort и др.)

## Установка

1. Клонируйте репозиторий или загрузите архив:
   ```
   git clone https://github.com/username/folder-to-git.git
   cd folder-to-git
   ```

2. Сделайте скрипты исполняемыми:
   ```
   chmod +x folder_to_git.py folder_to_git.sh
   ```

## Использование

### Python-скрипт

```bash
python folder_to_git.py --source /путь/к/папкам/с/версиями --target /путь/к/репозиторию [опции]
```

Опции:
- `--source`, `-s`: Директория с папками версий (обязательный параметр)
- `--target`, `-t`: Путь для создания Git-репозитория (обязательный параметр)
- `--pattern`, `-p`: Шаблон для поиска папок с версиями (по умолчанию: "*")
- `--extract-pattern`, `-e`: Регулярное выражение для извлечения номера версии (по умолчанию: "[0-9]+(\.[0-9]+)?")
- `--authors-file`, `-a`: Файл с сопоставлением версий и авторов (формат: 'версия:имя:email')
- `--message-template`, `-m`: Шаблон сообщения коммита (по умолчанию: "Version {version} - Imported from folder '{folder}'")
- `--dry-run`, `-d`: Тестовый режим без создания репозитория
- `--verbose`, `-v`: Подробный вывод

### Shell-скрипт

```bash
./folder_to_git.sh --source /путь/к/папкам/с/версиями --target /путь/к/репозиторию [опции]
```

Опции:
- `--source`, `-s`: Путь к директории с папками версий (обязательный параметр)
- `--target`, `-t`: Путь для создания Git-репозитория (обязательный параметр)
- `--pattern`, `-p`: Шаблон для поиска папок с версиями (по умолчанию: все папки)
- `--extract`, `-e`: Регулярное выражение для извлечения номера версии (по умолчанию: "[0-9]+")
- `--dry-run`, `-d`: Тестовый режим без создания репозитория
- `--verbose`, `-v`: Подробный вывод
- `--clean`: Удалить существующий репозиторий перед созданием нового
- `--max=<число>`: Максимальное количество версий для обработки
- `--help`, `-h`: Вывод справки

## Примеры

### Простой пример

```bash
# Python
python folder_to_git.py --source ./versions --target ./project_repo

# Shell
./folder_to_git.sh --source ./versions --target ./project_repo
```

### Работа с различными форматами имен папок

```bash
# Для проектов с именами папок типа "project_v1.0"
python folder_to_git.py --source ./my_project --target ./git_repo --pattern "project_v*" --extract-pattern "[0-9]+\.[0-9]+"

# Для папок с именами "release-2.5.1-stable"
./folder_to_git.sh -s ./releases -t ./git_repo -p "release-*" -e "[0-9]+\.[0-9]+\.[0-9]+"
```

### Работа с датированными папками

```bash
# Для папок с датами в названиях "project_2023-05-12"
python folder_to_git.py --source ./dated_versions --target ./repo --pattern "project_*" --extract-pattern "20[0-9]{2}-[0-9]{2}-[0-9]{2}"
```

### Тестовый режим

```bash
# Python
python folder_to_git.py --source ./app_versions --target ./app_repo --dry-run --verbose

# Shell
./folder_to_git.sh --source ./app_versions --target ./app_repo --dry-run --verbose
```

### Работа с информацией об авторах

```bash
# Создание файла авторов
echo "1.0:John Doe:john@example.com" > authors.txt
echo "2.0:Jane Smith:jane@example.com" >> authors.txt

# Использование файла авторов
python folder_to_git.py --source ./project_versions --target ./git_repo --authors-file authors.txt
```

## Как работает автоматическое определение структуры проекта

Инструмент использует следующие критерии для определения структуры проекта:

1. Наличие файла `main.py` или других ключевых файлов в папке проекта
2. Наличие типичных каталогов проекта (`src`, `lib`, `handlers`, `keyboards` и т.д.)
3. Количество файлов исходного кода и их расположение
4. Вложенные структуры каталогов, характерные для конкретных типов проектов

Благодаря этому механизму инструмент работает с проектами на разных языках программирования и с различными структурами каталогов.

## Сортировка версий

Скрипты используют два критерия для сортировки папок:

1. **Приоритетный критерий**: Дата изменения самого старого файла в папке - это позволяет более точно восстановить хронологию проекта, даже если папки были перемещены или скопированы.
2. **Вторичный критерий**: Номер версии, извлеченный из имени папки - используется, если даты изменения совпадают.

Такой подход обеспечивает максимально точное восстановление хронологии проекта даже при отсутствии явных меток времени в именах папок.

## Примечания по использованию

1. **Определение версий**:
   - Скрипты пытаются извлечь версии из имен папок с помощью регулярных выражений.
   - Если версия не может быть определена, но шаблон поиска папок соответствует, папка все равно будет обработана.

2. **Безопасность**:
   - Скрипт автоматически исключает служебные директории и файлы (.git, .DS_Store, __pycache__ и др.).
   - Используется промежуточная временная директория для предотвращения проблем с копированием.

3. **Ограничения**:
   - Файлы в корне папок версий копируются в корень репозитория.
   - Структура папок внутри каждой версии сохраняется.

## Устранение неполадок

1. **Проблемы с определением версий**:
   - Настройте регулярное выражение с помощью параметра `--extract-pattern` (Python) или `--extract` (Shell).
   - Используйте тестовый режим (`--dry-run`) для проверки извлеченных версий.

2. **Ошибки Git**:
   - Убедитесь, что Git установлен и доступен в PATH.
   - Проверьте наличие достаточных прав для создания и записи в целевую директорию.

3. **Проблемы с определением структуры проекта**:
   - Используйте режим подробного вывода (`--verbose`), чтобы увидеть, как скрипт определяет структуру.
   - Для сложных случаев можно использовать конкретный шаблон поиска папок с опцией `--pattern`.

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле LICENSE.

## Авторы

- Авторы проекта

## Вклад в проект

Предложения, баг-репорты и pull request'ы приветствуются! Для крупных изменений, пожалуйста, сначала обсудите предлагаемые изменения, создав issue. 